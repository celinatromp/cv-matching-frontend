<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <h1>Onze trainees</h1>
    <h2>Nieuw trainees toevoegen</h2>
    <input type="text" id="invoer-voornaam" placeholder="vul voornaam in">
    <input type="text" id="invoer-achternaam" placeholder="vul achternaam in">
    <input type="number" id="invoer-leeftijd" placeholder="vul leeftijd in">
    <input type="text" id="invoer-woonplaats" placeholder="vul woonplaats in">
    <input type="text" id="invoer-specialisatie" placeholder="vul uw specialisatie in">
    <input type="text" id="invoer-bio" placeholder="vul uw bio in">
    <input type="text" id="traineeId" placeholder="vul een id nummer in">
    <button type="button" onclick="createTrainee()">Opslaan</button>
    <h2>Trainees Updaten</h2>
    <input type="text" id="update-voornaam" placeholder="vul voornaam in">
    <input type="text" id="update-achternaam" placeholder="vul achternaam in">
    <input type="number" id="update-leeftijd" placeholder="vul leeftijd in">
    <input type="text" id="update-woonplaats" placeholder="vul woonplaats in">
    <input type="text" id="update-specialisatie" placeholder="vul uw specialisatie in">
    <input type="text" id="update-bio" placeholder="vul uw bio in">
    <input type="text" id="update-traineeId" placeholder="vul een id nummer in">
    <button type="button" onclick="updateTrainee()">Update</button>
    
    <h2>Trainee verwijderen</h2>
    <input type="text" id="delete-traineeId" placeholder="vul een id nummer in">
    <button type="button" onclick="deleteTrainee()">Delete</button>
    <br>
    <h2>Tabel van Trainees</h2>
    <table id="trainee-table">
    </table>
   
    <script>
    function deleteTrainee(){
      let deletetraineeId = document.getElementById("delete-traineeId").value;
      if(!confirm(`Weet je zeker dat de trainee met ID ${deletetraineeId} wilt verwijderen?`)){
        return;
      }
      fetch(`http://localhost:8080/trainee/${deletetraineeId}/delete`,{
        method: "DELETE",
    
      })
      .then((res) => {
          if (!res.ok) {
              throw new Error(`Trainee met ID ${deletetraineeId} kon niet worden verwijderd.`);
              }
          alert(`Trainee met ID ${deletetraineeId} is succesvol verwijderd!`);
          loadData();
      })
      .catch((error) => {
          console.error(`Fout bij het verwijderen van trainee met ID ${deletetraineeId}:`, error);
            alert(`Er is een fout opgetreden bij het verwijderen van trainee ${deletetraineeId}. Probeer het opnieuw.`);
      });
};

    function updateTrainee() {
    // Step 1: Get the trainee ID from input field
    let traineeId = document.getElementById("update-traineeId").value;
    // Step 2: Collect updated data from input fields
    let updatedTraineeData = {
        "voornaam": document.getElementById("update-voornaam").value,
        "achternaam": document.getElementById("update-achternaam").value,
        "leeftijd": document.getElementById("update-leeftijd").value,
        "woonplaats": document.getElementById("update-woonplaats").value,
        "specialisatie": document.getElementById("update-specialisatie").value,
        "bio": document.getElementById("update-bio").value 
    };
    // Step 3: Send the updated data to the server
    fetch(`http://localhost:8080/trainee/${traineeId}/update`, {
        method: "PUT",
        headers: {
            "Content-type": "application/json"
        },
        body: JSON.stringify(updatedTraineeData)
    })
    .then(res => {
        if (!res.ok) {
            throw new Error(`HTTP error! status: ${res.status}`);
        }
        // Check if the response is empty
        if (res.headers.get("content-length") === "0" || res.status === 204) {
            return {}; }
        else {
          return res.json();
        } 
    })
    .then(updatedTraineeData => {
        // Step 4: Handle response from the server
        // Show an alert with the entire server response
        alert("Trainee with ID " + traineeId + " was updated!");
        // Call loadData() after the fetch request is completed and the alert is shown
        loadData();
    })
    .catch(e => {
        console.log('There was a problem with the fetch operation: ' + e.message);
    });
};

      function createTrainee() {
        //stap 1 - Verzamelen van data uit de invoer velden
        let newTrainee = {
          "voornaam": document.getElementById("invoer-voornaam").value,
          "voornaam": document.getElementById("invoer-voornaam").value,
          "achternaam": document.getElementById("invoer-achternaam").value,
          "leeftijd": document.getElementById("invoer-leeftijd").value,
          "woonplaats": document.getElementById("invoer-woonplaats").value,
          "specialisatie": document.getElementById("invoer-specialisatie").value,
          "bio": document.getElementById("invoer-bio").value
        };
        //stap 2 - Sturen van de nieuwe trainee
        fetch("http://localhost:8080/trainee/create", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(newTrainee),
        })
          .then((res) => res.json())
          .then((newTrainee) => {
            alert("Trainee aangemaakt met id: " + newTrainee.id);

            //stap 3 - Herladen van de table
            loadData();
          });
      }

      function loadData() {
        fetch("http://localhost:8080/trainee/all")
          .then((res) => res.json())
          .then((trainees) => {
            console.log("trainees", trainees);
            //tijdelijke html voor in de tabel
            let traineesHtml = "";
            trainees.forEach((trainee) => {
              traineesHtml += `
                    <tr>
                        <td>
                            ${trainee.id}
                        </td>
                        <td>
                            ${trainee.voornaam}
                        </td>
                        <td>
                            ${trainee.achternaam}
                        </td>
                        <td>
                            ${trainee.leeftijd}
                        </td>
                        <td>
                            ${trainee.woonplaats}
                        </td>
                        <td>
                            ${trainee.specialisatie}
                        </td>
                        <td>
                            ${trainee.bio}
                        </td>
                       
                    </tr>
                `;
            });
            document.getElementById("trainee-table").innerHTML = `
                        <tr>
                            <th>id </th>
                            <th>Voornaam </th>
                            <th>Achternaam </th>
                            <th>Leeftijd </th>
                            <th>Woonplaats </th>
                            <th>Specalisatie </th>
                            <th>Bio </th>
                        </tr>
          
            ${traineesHtml}`;
          });
        console.log("After fetch");
      }
      loadData();
    </script>
  </body>
</html>
